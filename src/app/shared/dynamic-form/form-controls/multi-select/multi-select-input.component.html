<mat-form-field appearance="fill">
    <mat-label>{{ controlConfig.label }}</mat-label>
    <mat-select [formControl]="control" multiple panelClass="multi-select-panel" #select (openedChange)="resetSearch()">

        <!-- Search Box -->
        <mat-form-field class="search-box">
            <mat-icon matPrefix>search</mat-icon>
            <input matInput placeholder="Search" [(ngModel)]="searchTerm" (keyup)="filterOptions()" />
        </mat-form-field>

        <!-- Select All -->
        <mat-option (click)="toggleSelectAll()" [value]="allSelected ? [] : allOptions">
            <mat-checkbox [checked]="allSelected">Select All</mat-checkbox>
        </mat-option>

        <!-- Filtered Options -->
        <mat-option *ngFor="let option of filteredOptions" [value]="option.Key">
            <mat-checkbox [checked]="isSelected(option.Key)">{{ option.Value }}</mat-checkbox>
        </mat-option>

    </mat-select>
    <mat-error *ngIf="control.invalid && control.touched">
        {{ getErrorMessage() }}
      </mat-error>
</mat-form-field>